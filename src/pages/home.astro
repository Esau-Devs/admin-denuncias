---
import FiltrarDenuncia from "../components/organisms/FiltrarDenuncia.jsx";
import Layout from "../layouts/Layout.astro";
import Header from "../components/atoms/Header.astro";

// Valores iniciales (se actualizarán con JavaScript del lado del cliente)
let TotalDenuncias = 0;
let Pendiente = 0;
let Enproceso = 0;
let resuelta = 0;
---

<Layout title="Inicio de denuncias">
    <Header />
    <main class="bg-[#f5f7f7] min-h-screen m-5">
        <div class="container mx-auto">
            
            <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 my-10">
                <article class="bg-white border border-gray-300 p-6 rounded-2xl shadow-sm text-center hover:shadow-md transition-shadow">
                    <span id="total-denuncias" class="text-4xl font-semibold text-black">
                        {TotalDenuncias}
                    </span>
                    <p class="text-sm text-gray-600 mt-2">Total de denuncias</p>
                </article>

                <article class="bg-white border border-gray-300 p-6 rounded-2xl shadow-sm text-center hover:shadow-md transition-shadow">
                    <span id="pendiente-denuncias" class="text-4xl font-semibold text-black">
            
                        {Pendiente}
                    </span>
                    <p class="text-sm text-gray-600 mt-2">Denuncias pendientes</p>
                </article>

                <article class="bg-white border border-gray-300 p-6 rounded-2xl shadow-sm text-center hover:shadow-md transition-shadow">
                    <span id="enproceso-denuncias" class="text-4xl font-semibold text-black">
                        {Enproceso}
                    </span>
             
                    <p class="text-sm text-gray-600 mt-2">Denuncias en proceso</p>
                </article>

                <article class="bg-white border border-gray-300 p-6 rounded-2xl shadow-sm text-center hover:shadow-md transition-shadow">
                    <span id="resuelta-denuncias" class="text-4xl font-semibold text-black">
  
                        {resuelta}
                    </span>
                    <p class="text-sm text-gray-600 mt-2">Denuncias completadas</p>
                </article>
            </section>

      
                <FiltrarDenuncia client:load />
        </div>
    </main>
</Layout>
<script is:inline>
    // Envolvemos el código en una IIFE para evitar conflictos y ayudar al IDE
    (() => {
        // Función para actualizar los contadores en el DOM
        const updateCards = (counts) => {
            // Document y getElementById son válidos aquí porque se ejecuta en el navegador
            document.getElementById('total-denuncias').textContent = counts.total;
            document.getElementById('pendiente-denuncias').textContent = counts.pendiente;
            document.getElementById('enproceso-denuncias').textContent = counts.enproceso;
            document.getElementById('resuelta-denuncias').textContent = counts.resuelta; 
        };

        // Escuchar el evento que dispara el componente de React (FiltrarDenuncia.jsx)
        // event.detail contiene el objeto { total, pendiente, enproceso, completada }
        window.addEventListener('denunciaDataLoaded', (event) => {
            // counts y detail son válidos aquí
            updateCards(event.detail);
        });
    })();
</script>